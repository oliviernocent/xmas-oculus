<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Xmas</title>
    <meta name="description" content="Spring is coming!" />
    <!-- A-Frame JavaScript library -->
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <!-- A-Frame physics system -->
    <script
        src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <!-- A-Frame extras -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
</head>

<body>
    <a-scene physics="gravity: 0" renderer="antialias: true">
        <a-assets>
            <img id="hardwood" src="images/hardwood-floor.jpg">
            <img id="wallpaper" src="images/stripe-wallpaper.jpeg">
            <img id="angry" src="images/angry.jpg">
            <img id="rude" src="images/rude.png">
            <img id="check" src="images/check.png">
            <img id="busy" src="images/macbook.png">
            <a-asset-item id="tree" src="models/tree/scene.gltf"></a-asset-item>
            <a-asset-item id="fireplace" src="models/fireplace/scene.gltf"></a-asset-item>
        </a-assets>

        <!-- Left hand -->
        <a-entity id="leftController" static-body="shape: sphere; sphereRadius: 0.02;"
            oculus-touch-controls="hand: left" sphere-collider="objects: .throwable" grab>
        </a-entity>

        <!-- Right hand -->
        <a-entity id="rightController" static-body="shape: sphere; sphereRadius: 0.02;"
            oculus-touch-controls="hand: right" sphere-collider="objects: .throwable" grab>
        </a-entity>

        <a-box id="anchor1" width="0.01" height="0.01" depth="0.01" static-body
            animation="property: position; from: 0 0.5 -0.5; to: 0 2 -0.5; easing: easeInOutCubic; dur: 4000; dir: alternate; loop: true">
        </a-box>
        <a-sphere id="sphere1" position="0 0.5 -0.5" radius="0.10" color="#4CC3D9" dynamic-body="shape: sphere"
            constraint="type: distance; target: #anchor1; distance: 0.001; collideConnected: false">
        </a-sphere>

        <a-box id="anchor2" width="0.01" height="0.01" depth="0.01" static-body
            animation="property: position; from: -0.5 0.5 0.5; to: 0.5 0.5 0.5; easing: easeInOutCubic; dur: 4000; dir: alternate; loop: true"
            visible="false">
        </a-box>
        <a-sphere id="sphere2" position="-0.5 0.5 0.5" radius="0.10" color="#FFC65D" dynamic-body="shape: sphere"
            constraint="type: distance; target: #anchor2; distance: 0.00001; collideConnected: false" visible="false">
        </a-sphere>

        <!-- Ground -->
        <a-plane static-body rotation="-90 0 0" width="8" height="8" src="#hardwood" repeat="4 4" roughness="0.7"
            metalness="0.3">
        </a-plane>

        <!-- Walls -->
        <a-plane static-body position="0 1.5 -4" width="8" height="3" src="#wallpaper" repeat="8 3" roughness="1"
            metalness="0">
        </a-plane>
        <a-box position="0 0.06 -4" width="8" height="0.12" depth="0.02" color="white" roughness="1" metalness="0">
        </a-box>

        <a-plane static-body position="0 1.5 4" rotation="0 180 0" width="8" height="3" src="#wallpaper" repeat="8 3"
            roughness="1" metalness="0">
        </a-plane>
        <a-box position="0 0.06 4" width="8" height="0.12" depth="0.02" color="white" roughness="1" metalness="0">
        </a-box>

        <a-plane static-body position="-4 1.5 0" rotation="0 90 0" width="8" height="3" src="#wallpaper" repeat="8 3"
            roughness="1" metalness="0">
        </a-plane>
        <a-box position="-4 0.06 0" width="0.02" height="0.12" depth="8" color="white" roughness="1" metalness="0">
        </a-box>

        <a-plane static-body position="4 1.5 0" rotation="0 -90 0" width="8" height="3" src="#wallpaper" repeat="8 3"
            roughness="1" metalness="0">
        </a-plane>
        <a-box position="4 0.06 0" width="0.02" height="0.12" depth="8" color="white" roughness="1" metalness="0">
        </a-box>

        <!-- Ceiling -->
        <a-plane static-body position="0 3 0" rotation="90 0 0" width="8" height="8" color="white" roughness="1"
            metalness="0"></a-plane>

        <!-- Christmas tree -->
        <a-gltf-model static-body="shape: box" src="#tree" position="-2.644 0 -2.777" rotation="0 -152 0"
            scale="0.8 0.8 0.8"></a-gltf-model>
        <a-gltf-model static-body="shape: box" src="#fireplace" position="2.638 0 -3.382" rotation="0 -9.512 0"
            scale="0.03 0.03 0.03">
        </a-gltf-model>

        <a-circle src="#rude" radius="0.5" position="1.82715 1.89076 3.98" rotation="0 180 0"></a-circle>
        <a-ring radius-inner="0.48" radius-outer="0.52" position="1.82715 1.89076 3.97" rotation="0 180 0"
            color="#ebc356" metalness="0.75" roughness="0.5"></a-ring>
        <a-circle src="#check" radius="0.5" position="0.72226 1.52811 3.98" rotation="0 180 0"></a-circle>
        <a-ring radius-inner="0.48" radius-outer="0.52" position="0.72226 1.52811 3.97" rotation="0 180 0"
            color="#ebc356" metalness="0.75" roughness="0.5"></a-ring>
        <a-circle src="#angry" radius="0.5" position="-0.41231 1.98922 3.98" rotation="0 180 0"></a-circle>
        <a-ring radius-inner="0.48" radius-outer="0.52" position="-0.41231 1.98922 3.97" rotation="0 180 0"
            color="#ebc356" metalness="0.75" roughness="0.5"></a-ring>
        <a-circle src="#busy" radius="0.5" position="-1.44021 1.42999 3.98" rotation="0 180 0"></a-circle>
        <a-ring radius-inner="0.48" radius-outer="0.52" position="-1.44021 1.42999 3.97" rotation="0 180 0"
            color="#ebc356" metalness="0.75" roughness="0.5"></a-ring>

        <!-- Lights -->
        <a-entity light="type: ambient; color: white; intensity: 0.5"></a-entity>
        <a-entity light="type: point; color: white; intensity: 0.3" position="0 1.5 0"></a-entity>
        <a-entity light="type: point; color: yellow; intensity: 1; distance: 1.5" position="-2.644 0.5 -2.777">
        </a-entity>
        <a-entity light="type: point; color: pink; intensity: 1; distance: 1.5" position="-2.644 1.7 -2.777"></a-entity>

        <a-camera position="0 1.7 0">
        </a-camera>
    </a-scene>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            let scene = document.querySelector('a-scene');

            let giftCount = 0;
            function giftAvalanche() {
                let gift = document.createElement('a-box');

                let size = Math.random() * 0.40 + 0.1;
                gift.setAttribute('width', size);
                gift.setAttribute('height', size);
                gift.setAttribute('depth', size);
                gift.setAttribute('color', 'hsl(' + Math.random() * 360 + ', 90%, 70%)');
                gift.setAttribute('position', (Math.random() * 2 - 1) + ' 2.6 ' + (Math.random() * 2 - 1));
                gift.setAttribute('dynamic-body', 'shape: box; mass: 2');
                gift.classList.add('throwable');

                scene.appendChild(gift);

                if (++giftCount < 50) window.setTimeout(giftAvalanche, 150);
            }

            document.querySelector('#sphere1').addEventListener('collide', (e) => {
                if (e.detail.body.el.id === 'leftController' || e.detail.body.el.id === 'rightController') {
                    e.detail.target.el.setAttribute('visible', 'false');
                    document.querySelector('#anchor1').setAttribute('visible', 'false');
                    document.querySelector('#anchor2').setAttribute('visible', 'true');
                    document.querySelector('#sphere2').setAttribute('visible', 'true');
                }
            });

            document.querySelector('#sphere2').addEventListener('collide', (e) => {
                if (e.detail.body.el.id === 'leftController' || e.detail.body.el.id === 'rightController') {
                    e.detail.target.el.setAttribute('visible', 'false');
                    document.querySelector('#anchor2').setAttribute('visible', 'false');

                    scene.systems.physics.driver.world.gravity.set(0, -9.81, 0);
                    giftAvalanche();
                }
            });
        });
    </script>
</body>

</html>