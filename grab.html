<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Xmas</title>
    <!-- A-Frame JavaScript library -->
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <!-- A-Frame extras -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <!-- Ammo.js -->
    <script src="https://cdn.jsdelivr.net/gh/MozillaReality/ammo.js@8bbc0ea/builds/ammo.wasm.js"></script>
    <!-- A-Frame physics system -->
    <script
        src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.4/dist/aframe-physics-system.min.js"></script>
    <!-- Event set component -->
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
</head>

<body>
    <a-scene physics="driver: ammo; debug: false; debugDrawMode: 1;" shadow="type: pcfsoft" renderer="antialias: true">
        <a-assets>
            <img id="hardwood" src="images/hardwood-floor.jpg">
            <img id="wallpaper" src="images/stripe-wallpaper.jpeg">
            <img id="angry" src="images/angry.jpg">
            <img id="rude" src="images/rude.png">
            <img id="check" src="images/check.png">
            <img id="busy" src="images/macbook.png">
            <a-asset-item id="tree" src="models/tree/scene.gltf"></a-asset-item>
            <a-asset-item id="fireplace" src="models/fireplace/scene.gltf"></a-asset-item>
        </a-assets>

        <!-- Left hand -->
        <a-entity id="leftHand" hand-tracking-grab-controls="hand: left; hoverEnabled: true;"></a-entity>
        <!--
        <a-entity id="leftController" hand-controls="hand: left; handModelStyle: highPoly; color: #ffffff"
            static-body="shape: sphere; sphereRadius: 0.02;" sphere-collider="objects: .throwable" grab>
        </a-entity>
        -->

        <!-- Right hand -->
        <a-entity id="rightHand" hand-tracking-grab-controls="hand: right; hoverEnabled: true;"></a-entity>
        <!--
        <a-entity id="rightController"
            hand-controls="hand: right; handModelStyle: highPoly; color: rgba(255,255,255,0.4)"
            static-body="shape: sphere; sphereRadius: 0.02;" sphere-collider="objects: .throwable" grab>
        </a-entity>
        -->

        <a-sphere id="sphere1" class="throwable" ammo-body="type: dynamic" ammo-shape="type: sphere"
            position="-0.5 0.11 -0.5" radius="0.10" color="#4CC3D9" shadow="cast: true; receive: true">
        </a-sphere>
        <a-sphere id="sphere2" class="throwable" ammo-body="type: dynamic" ammo-shape="type: sphere"
            position="0.5 0.11 -0.5" radius="0.10" color="#FFC65D" shadow="cast: true; receive: true">
        </a-sphere>

        <a-box id="box1" ammo-body="type: static" ammo-shape="type: box" position="0.8 0 1" rotation=" 0 45 0"
            height="0.3" color="#4CC3D9" shadow="cast: true; receive: true"></a-box>
        <a-box id="box2" ammo-body="type: static" ammo-shape="type: box" position="-0.8 0 1" height="0.3"
            color="#FFC65D" shadow="cast: true; receive: true"></a-box>

        <!-- Ground -->
        <a-box ammo-body="type: static" ammo-shape="type: box" rotation="-90 0 0" width="8" height="8" depth="0.1"
            material="src: #hardwood; repeat: 4 4; roughness: 0.7; metalness: 0.3;" shadow="cast: false; receive: true">
        </a-box>

        <!-- Walls -->
        <a-box ammo-body="type: static" ammo-shape="type: box" position="0 1.5 -4" width="8" height="3" depth="0.1"
            src="#wallpaper" repeat="8 3" roughness="1" metalness="0" shadow="cast: false; receive: true">
        </a-box>
        <a-box position="0 0.06 -4" width="8" height="0.12" depth="0.12" color="white" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>

        <a-box ammo-body="type: static" ammo-shape="type: box" position="0 1.5 4" rotation="0 180 0" width="8"
            height="3" depth="0.1" src="#wallpaper" repeat="8 3" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>
        <a-box position="0 0.06 4" width="8" height="0.12" depth="0.12" color="white" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>

        <a-box ammo-body="type: static" ammo-shape="type: box" position="-4 1.5 0" rotation="0 90 0" width="8"
            height="3" depth="0.1" src="#wallpaper" repeat="8 3" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>
        <a-box position="-4 0.06 0" width="0.12" height="0.12" depth="8" color="white" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>

        <a-box ammo-body="type: static" ammo-shape="type: box" position="4 1.5 0" rotation="0 -90 0" width="8"
            height="3" depth="0.1" src="#wallpaper" repeat="8 3" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>
        <a-box position="4 0.06 0" width="0.12" height="0.12" depth="8" color="white" roughness="1" metalness="0"
            shadow="cast: false; receive: true">
        </a-box>

        <!-- Ceiling -->
        <a-box ammo-body="type: static" ammo-shape="type: box" position="0 3 0" rotation="90 0 0" width="8" height="8"
            depth="0.1" color="white" roughness="1" metalness="0" shadow="cast: false; receive: true">
        </a-box>

        <!-- Christmas tree -->
        <a-gltf-model src="#tree" position="-2.644 0 -2.777" rotation="0 -152 0" scale="0.8 0.8 0.8"></a-gltf-model>
        <a-box ammo-body="type: static" ammo-shape="type: box" position="-2.899 1.074 -2.832" scale="1.73 2.12 1.229"
            opacity="0"></a-box>
        <a-gltf-model src="#fireplace" position="2.638 0 -3.382" rotation="0 -9.512 0"
            scale="0.03 0.03 0.03"></a-gltf-model>
        <a-box ammo-body="type: static" ammo-shape="type: box" position="3.70369 0.52811 -3.75149"
            rotation="0 -42.045 0" scale="1.49602 1.5363 1.229" opacity="0"></a-box>

        <!-- Hall of Fame -->
        <a-circle src="#rude" radius="0.5" position="1.82715 1.89076 3.94" rotation="0 180 0">
            <a-ring radius-inner="0.48" radius-outer="0.52" position="0 0 0.01" color="#ebc356" metalness="0.75"
                roughness="0.5"></a-ring>
        </a-circle>
        <a-circle src="#check" radius="0.5" position="0.72226 1.52811 3.94" rotation="0 180 0">
            <a-ring radius-inner="0.48" radius-outer="0.52" position="0 0 0.01" color="#ebc356" metalness="0.75"
                roughness="0.5"></a-ring>
        </a-circle>
        <a-circle src="#angry" radius="0.5" position="-0.41231 1.98922 3.94" rotation="0 180 0">
            <a-ring radius-inner="0.48" radius-outer="0.52" position="0 0 0.01" color="#ebc356" metalness="0.75"
                roughness="0.5"></a-ring>
        </a-circle>
        <a-circle src="#busy" radius="0.5" position="-1.44021 1.42999 3.94" rotation="0 180 0">
            <a-ring radius-inner="0.48" radius-outer="0.52" position="0 0 0.01" color="#ebc356" metalness="0.75"
                roughness="0.5"></a-ring>
        </a-circle>

        <!-- Lights -->
        <a-entity light="type: ambient; color: white; intensity: 0.3"></a-entity>
        <a-entity
            light="type: point; color: white; intensity: 2.8; castShadow: true; shadowMapWidth: 2048; shadowMapHeight: 2048"
            position="0 2.7 0"></a-entity>
        <a-entity light="type: point; color: yellow; intensity: 1; distance: 1.5;" position="-2.644 0.5 -2.777">
        </a-entity>
        <a-entity light="type: point; color: pink; intensity: 1; distance: 1.5" position="-2.644 1.7 -2.777"></a-entity>

        <a-camera>
        </a-camera>
    </a-scene>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            let scene = document.querySelector('a-scene');
            let score = 0;

            let giftCount = 0;
            function giftAvalanche() {
                let gift = document.createElement('a-box');

                let size = Math.random() * 0.40 + 0.1;
                gift.setAttribute('width', size);
                gift.setAttribute('height', size);
                gift.setAttribute('depth', size);
                gift.setAttribute('color', `hsl(${Math.random() * 360}, 90%, 70%)`);
                gift.setAttribute('shadow', 'cast: true; receive: true');
                gift.setAttribute('position', `${Math.random() * 2 - 1} 2.6 ${Math.random() * 2 - 1}`);
                gift.setAttribute('ammo-body', `type: dynamic; mass: ${size / 2}`);
                gift.setAttribute('ammo-shape', 'type: box');
                gift.setAttribute('grabbable', 'type: box');

                scene.appendChild(gift);

                if (++giftCount < 100) window.setTimeout(giftAvalanche, 150);
            }

            /*
            document.querySelector('#box1').addEventListener('collide', (e) => {
                if (e.detail.body.el.id === 'sphere1') {
                    e.detail.target.el.setAttribute('visible', 'false');
                    e.detail.body.el.setAttribute('visible', 'false');

                    if (++score === 2) giftAvalanche();
                }
            });

            document.querySelector('#box2').addEventListener('collide', (e) => {
                if (e.detail.body.el.id === 'sphere2') {
                    e.detail.target.el.setAttribute('visible', 'false');
                    e.detail.body.el.setAttribute('visible', 'false');

                    if (++score === 2) giftAvalanche();
                }
            });
            */

            window.setTimeout(giftAvalanche, 5000);
        });
    </script>
</body>

</html>